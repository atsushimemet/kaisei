# KAISEI（カイセイ）プロダクト設計ドキュメント

## 概要

KAISEIは、3〜6人規模の親しい仲間との飲み会に特化した精算支援アプリケーションです。幹事が直面する「精算の手間」と「参加者・お店・ローカルルールの管理」をスマートに処理し、透明性のある精算を実現します。

---

## 1. ユーザーの課題

### 1.1 現状の問題点

#### 精算の複雑さ
- **参加時間の違い**: 「誰がどこまでいたか」の管理が煩雑
- **金額計算の困難**: 会ごとに異なる参加者と金額で計算が複雑
- **支払者の分散**: 複数人が支払うと「誰から誰にいくら払うか」が不明確

#### ローカルルールの反映困難
- **性別による配分**: 「男性が多めに払う」など慣習的なルールが反映できない
- **役職・年齢による配分**: 「先輩が多めに払う」などの関係性を考慮できない
- **個別事情の反映**: 途中参加・途中退席などの細かい調整が困難

#### 精算プロセスの非効率性
- **支払い方法の多様性**: PayPay、現金、LINE Payなど人によって異なる希望への対応
- **催促・確認の手間**: 未払い者への個別連絡や確認作業
- **透明性の欠如**: 計算根拠が不明確で納得感が得られない

### 1.2 対象ユーザーの特徴

- **頻度**: 月1〜2回程度の飲み会を主催
- **規模**: 3〜6人の小規模グループ
- **関係性**: 友人・後輩・先輩などの親しい仲間
- **志向**: 合理化を求めつつも関係性に配慮した丁寧な対応を重視

---

## 2. KAISEIの提供する解決策

### 2.1 コア機能による課題解決

#### 飲み会登録・参加者管理
```
解決する課題: 参加者情報と属性の一元管理
```
- **参加者属性の体系化**: ニックネーム、性別、役割、滞在範囲を構造化
- **滞在時間の詳細設定**: 各会における参加率（0.0〜1.0）による柔軟な調整
- **編集・削除機能**: リアルタイムでの参加者情報更新

#### 傾斜配分機能
```
解決する課題: ローカルルールの自動反映
```
- **性別係数**: 男性1.0、女性0.8（デフォルト、カスタマイズ可能）
- **役職係数**: 先輩1.2、後輩1.0（デフォルト、カスタマイズ可能）
- **参加率係数**: 滞在時間に応じた按分計算
- **複合計算**: 各係数を掛け合わせた最終金額の自動算出

#### 透明性のある計算ロジック
```
解決する課題: 計算根拠の明確化
```
- **計算式の可視化**: 基本金額 × 性別係数 × 役職係数 × 参加率
- **内訳の詳細表示**: 各会場・各参加者ごとの計算過程を表示
- **リアルタイム更新**: 情報変更時の即座な再計算

#### 支払案内メッセージ生成
```
解決する課題: 個別連絡の効率化
```
- **個人別メッセージ**: 各参加者専用の精算案内を自動生成
- **LINEコピペ対応**: そのままLINEに貼り付け可能な形式
- **詳細内訳付き**: 各会場の参加状況と金額内訳を含む

### 2.2 技術的解決アプローチ

#### フロントエンド
- **Next.js 14 + TypeScript**: 型安全性とパフォーマンスの両立
- **Tailwind CSS**: レスポンシブ対応とモダンUI
- **React Hooks**: 状態管理とリアルタイム更新

#### バックエンド
- **Next.js API Routes**: サーバーレス対応とスケーラビリティ
- **PostgreSQL + Prisma**: 堅牢なデータ管理とtype-safe DB操作

#### ユーザビリティ
- **ログイン不要**: 共有URLでの即座アクセス
- **自動保存機能**: LocalStorageによるデータ永続化
- **モバイルファースト**: スマートフォン最適化UI

---

## 3. KAISEIの利用方法

### 3.1 基本的な利用フロー

#### ステップ1: 飲み会情報の登録
```
画面: /events/new
操作: 基本情報入力
```
1. **飲み会名**: イベントのタイトル設定
2. **開催日**: 日付選択
3. **自動保存**: 入力内容は自動的に保存され、ページ離脱時も復元可能

#### ステップ2: 参加者の追加
```
画面: 参加者管理セクション
操作: 参加者情報入力
```
1. **基本情報入力**:
   - ニックネーム（必須）
   - 性別（男性/女性/未設定）
   - 役割（先輩/後輩/フラット）

2. **滞在時間設定**:
   - 1次会参加率: 0.0（不参加）〜1.0（全時間参加）
   - 2次会参加率: 同上
   - 3次会参加率: 同上

3. **編集・削除**: 追加後も自由に修正可能

#### ステップ3: お店情報の登録
```
画面: お店管理セクション
操作: 会場情報入力
```
1. **会場情報入力**:
   - 次会（1次会、2次会、3次会）
   - 店名
   - 総金額（税込）
   - 支払者（参加者から選択）

2. **複数会場対応**: 次会ごとに複数店舗の登録可能

#### ステップ4: 精算設定の調整（オプション）
```
画面: /settings
操作: 傾斜配分ルール調整
```
1. **設定画面への移動**: 「⚙️設定画面で傾斜を調整できます」リンクから
2. **係数調整**:
   - 性別による係数（デフォルト: 男性1.0、女性0.8）
   - 役職による係数（デフォルト: 先輩1.2、後輩1.0）
3. **プレビュー**: 設定変更による金額変化をリアルタイム確認

#### ステップ5: 飲み会作成・精算実行
```
画面: 確認・作成
操作: 最終確認と精算実行
```
1. **入力内容確認**: 参加者・会場・設定の最終チェック
2. **飲み会作成**: データベースへの保存と精算計算実行
3. **結果表示**: 個人別精算金額と支払案内メッセージの生成

### 3.2 精算結果の活用

#### 個人別メッセージの送信
```
自動生成される精算案内例:
```
```
昨日はありがとう！以下、精算金額の案内です。

🍺 1次会（焼肉ホルモン）：¥18,000
🍸 2次会（Bar SORA）：¥6,000
合計：¥24,000
→ あなたの支払額：¥3,900

デフォルトはPayPayです。
それ以外（現金、LINE Payなど）をご希望の方はこのメッセージに返信してください！
```

#### PayPay送金リンクの作成
1. **リンク作成ガイド**: PayPayアプリでの送金リンク作成手順を表示
2. **金額自動設定**: 個人別金額が事前に表示
3. **手動配布**: 生成されたリンクを各参加者に個別送信

### 3.3 データ管理機能

#### 自動保存・復元
- **LocalStorage活用**: ブラウザ閉鎖時以外はデータ保持
- **設定画面連携**: 設定変更時のデータ保持
- **エラー回復**: 予期しない離脱からの復元

#### データクリア
- **手動クリア**: 「データをクリア」ボタンによる即座リセット
- **自動クリア**: 飲み会作成完了時の自動クリア

---

## 4. 利用後のユーザー状態

### 4.1 幹事（主催者）の状態変化

#### 精神的負担の軽減
```
Before: 精算計算と個別連絡に数時間を要する
After: 10分程度で全ての精算業務が完了
```
- **計算ストレスの解消**: 複雑な按分計算からの解放
- **確認作業の効率化**: 自動生成メッセージによる連絡時間短縮
- **透明性による安心感**: 計算根拠の明確化による心理的負担軽減

#### 関係性維持の向上
```
Before: 精算の不透明さによる関係性への不安
After: 明確な計算根拠による信頼関係の強化
```
- **ローカルルール反映**: 慣習的配分の自動適用による配慮の実現
- **個別事情の考慮**: 途中参加・退席への柔軟な対応
- **公平感の醸成**: 全参加者が納得できる透明な精算

#### 継続的な幹事業務への意欲向上
```
Before: 精算の煩雑さから幹事役を避ける傾向
After: 効率的な精算により積極的な幹事引受け
```
- **業務負荷軽減**: 精算業務の自動化による時間創出
- **成功体験の蓄積**: スムーズな精算による幹事としての自信向上
- **継続性の確保**: 定期的な飲み会開催への動機維持

### 4.2 参加者の状態変化

#### 支払いプロセスの明確化
```
Before: 「なぜこの金額？」という疑問と不満
After: 計算根拠の理解による納得感
```
- **透明性による信頼**: 詳細な内訳表示による計算過程の理解
- **個別配慮の実感**: 自身の参加状況が正確に反映されている安心感
- **支払い方法の選択**: PayPay以外の決済手段も選択可能

#### コミュニケーションの改善
```
Before: 精算に関する個別確認や問い合わせ
After: 事前の詳細説明による円滑なやり取り
```
- **事前情報共有**: 詳細な精算案内による事前理解
- **質問・確認の減少**: 十分な情報提供による疑問の解消
- **支払い意欲の向上**: 納得感のある金額設定による積極的な支払い

#### 飲み会参加への積極性向上
```
Before: 精算の不透明さによる参加躊躇
After: 明確な精算システムによる安心した参加
```
- **事前予測可能性**: 参加パターンによる概算金額の把握
- **公平感の保証**: ローカルルール適用による適切な負担配分
- **信頼関係の強化**: 透明な精算による幹事への信頼向上



---

## 5. 技術的特徴と価値提案

### 5.1 ユーザビリティ設計
- **ゼロラーニングコスト**: 直感的なUI設計による即座の利用開始
- **エラー耐性**: 自動保存・復元機能による安全性確保
- **アクセシビリティ**: モバイルファースト設計による利用場面の拡大

### 5.2 スケーラビリティ
- **サーバーレス構成**: 利用者増加に対する柔軟な対応
- **データ永続化**: PostgreSQLによる安定したデータ管理
- **機能拡張性**: 将来的なLINE連携・決済API連携への対応準備

### 5.3 プライバシー保護
- **最小限の個人情報**: ニックネームベースの運用
- **一時的データ保存**: 必要最小限のデータ保持期間
- **ログイン不要**: 個人アカウント不要による心理的障壁の排除

---

## まとめ

KAISEIは、小規模飲み会の精算という日常的な課題に対して、技術的ソリューションを提供することで、ユーザーの精神的負担軽減と関係性の向上を実現します。単なる計算ツールではなく、コミュニティの結束を支援する社会的価値を創出するプロダクトとして設計されています。