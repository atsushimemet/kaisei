# 📄 PRD：飲み会精算支援アプリ「KAISEI（カイセイ）」v1.0

## 1. プロダクトの目的

3〜6人規模の気心知れた友人・先輩・後輩との飲み会に特化し、
幹事が毎回直面する「精算の手間」と「お店・参加メンバー・ローカルルールの管理」をスマートに処理する。
**精算の透明化・負担軽減・場の継続的な円滑化**を支援するツールを提供する。

---

## 2. 想定ユーザー

* 3〜6人規模の飲み会を月1〜2回主催している幹事
* 主な参加者は、仲の良い友人・後輩・先輩
* 幹事業務を合理化しつつも、関係性に配慮したやり取り・会計を丁寧に行いたい人

---

## 3. 解決する課題

* 少人数でも「誰がどこまでいたか」「いくら払えばよいか」が混乱しがち
* 会ごとに金額・参加者が異なるため計算が煩雑
* 支払い者が複数に跨ると、誰から誰にいくら払えばいいかが、分かりづらくなりがち
* 「男性が多めに払う」「先輩が多めに払う」といった**ローカルルールを反映できない**
* 支払い方法が人によって異なり、調整や催促が面倒

---

## 4. コア機能（MVP）

### 4.1 飲み会登録（幹事用）

* 飲み会のタイトル（日付含む）と参加者を登録
* 参加者ごとに：

  * ニックネーム
  * 性別（男性／女性／未設定）
  * 役割（先輩／後輩／フラット）
  * 滞在範囲（1次会のみ／2次会まで／3次会まで）
    　　※各会に「⚪︎次会途中」選択可能
    　　※4次以降も入力可能

### 4.2 会ごとのお店登録

* 会（1次会／2次会…）単位で、お店情報を登録：
  * 店名（自由入力＋Google Mapリンク）
  * 総金額（税込）
  * 支払者

### 4.3 傾斜配分機能

* 滞在範囲に応じた傾斜（例：1.0 → 0.7 → 0.5）
* 以下の**ローカルルールはデフォルトでON（設定画面で変更可）**：

  * 男性 → 1.0、女性 → 0.8
  * 先輩 → 1.2、後輩 → 1.0
* 会ごとに傾斜係数を掛け合わせて最終の支払い金額を算出
* 女性の支払い総額は~円を超えない制約を設定可能

### 4.4 支払案内（参加者向け）

* 幹事が精算ボタンを押すと、**各参加者ごとに共有可能なメッセージ**を生成：

　**例：**
　```
　昨日はありがとう！以下、精算金額の案内です。

　🍺 1次会（焼肉ホルモン）：¥18,000
　🍸 2次会（Bar SORA）：¥6,000
　合計：¥24,000
	→ あなたの支払額：¥3,900

　デフォルトはPayPayです。
　それ以外（現金、LINE Payなど）をご希望の方はこのメッセージに返信してください！
　```

* ※このメッセージは幹事がLINEにそのまま貼れる形式で出力される

### 4.5 PayPay支払いリンクガイド（初期プロダクト）

* 幹事が「精算を確定する」ボタンを押下すると、以下が自動で生成：

　- 各参加者の支払額リスト（名前 × 金額）
　- 「PayPayのリンク作成方法」簡易ガイド
　　（例：「PayPay → 個人間送金 → 金額入力 → URL共有」）

* 幹事が生成されたPayPayリンクを参加者に手動で貼り付け可能にする（API連携はPhase 2以降）

---

## 5. 非機能要件

* モバイルファースト設計
* ログイン不要（共有URLで参加者アクセス可能）
* ニックネーム＋属性だけで参加設定可能（個人情報は最小限）
* データは一時保存可（飲み会途中で離脱しても再編集可能）

---

## 6. 将来の拡張案（Phase 2以降）

* LINEログインと通知自動化
* 決済API（PayPay, LINE Pay）連携によるワンストップ送金
* 過去の飲み会テンプレート保存・複製機能
* 精算完了率・未払い記録ダッシュボード
* 店舗レビュー機能・おすすめ店共有機能

---

## 7. ユースケース例

**8月の飲み会（幹事：Aさん）**

* 参加者：A（男・先輩）、B（男・後輩）、C（女・後輩）

* Aは1次会〜2次会参加、BとCは1次会のみ参加（Cは途中退席）

* お店登録：

  * 1次会：焼肉 ¥18,000
  * 2次会：バー ¥6,000

* 傾斜ルールON：男性1.0 / 女性0.8、先輩1.2 / 後輩1.0

* 各人に以下のような案内を送信：

  ```
  参加ありがとう！あなたの支払額：¥4,200  
  デフォルトはPayPay、それ以外の支払い方法がよければ教えてね！
  ```

---

## 8. 技術スタック

* **フロントエンド**: Next.js 14, TypeScript, Tailwind CSS
* **バックエンド**: Next.js API Routes
* **データベース**: PostgreSQL
* **ORM**: Prisma
* **開発環境**: Docker, Docker Compose

---

## 9. 開発環境のセットアップ

### 前提条件

* Docker
* Docker Compose

### 1. リポジトリのクローン

```bash
git clone <repository-url>
cd kaisei
```

### 2. 環境変数の設定

```bash
cp env.example .env
```

`.env`ファイルを編集して、必要な環境変数を設定してください。

### 3. Docker環境の起動

```bash
# 開発環境の起動
docker compose up --build

# バックグラウンドで起動する場合
docker compose up -d --build
```

### 4. データベースの初期化

```bash
# Prismaクライアントの生成
docker compose exec app-dev npx prisma generate

# データベースマイグレーション
docker compose exec app-dev npx prisma db push
```

### 5. アプリケーションへのアクセス

* アプリケーション: http://localhost:3000
* データベース: localhost:5432

---

## 10. 開発コマンド

```bash
# 開発環境の起動
docker compose up

# 開発環境の停止
docker compose down

# ログの確認
docker compose logs -f app-dev

# データベースのリセット
docker compose down -v
docker compose up --build

# コンテナ内でコマンド実行
docker compose exec app-dev npm run lint
docker compose exec app-dev npx prisma studio
```

---

## 11. プロジェクト構造

```
kaisei/
├── src/
│   ├── app/                 # Next.js App Router
│   │   ├── api/            # API Routes
│   │   ├── events/         # 飲み会関連ページ
│   │   ├── globals.css     # グローバルスタイル
│   │   ├── layout.tsx      # ルートレイアウト
│   │   └── page.tsx        # ホームページ
│   ├── components/         # React コンポーネント
│   ├── lib/               # ユーティリティ関数
│   └── types/             # TypeScript 型定義
├── prisma/                # データベーススキーマ
├── Dockerfile             # 本番用Dockerfile
├── Dockerfile.dev         # 開発用Dockerfile
├── docker-compose.yml     # Docker Compose設定
└── init.sql              # データベース初期化SQL
```

---

## 12. 主要機能

### MVP機能

* 飲み会登録・管理機能
* 参加者管理機能
* お店登録機能
* 傾斜配分計算機能
* 精算メッセージ生成機能

### 今後の拡張予定

* LINE連携機能
* 決済API連携機能
* テンプレート保存機能
* 精算完了率ダッシュボード

---

## 13. データベース設計

詳細なデータベース設計については、`prisma/schema.prisma`を参照してください。

---

## 14. ライセンス

このプロジェクトはMITライセンスの下で公開されています。
